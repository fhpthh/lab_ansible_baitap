global
  log /dev/log local0
  log /dev/log local1 notice
  daemon
  maxconn 2048

defaults
  log global
  mode http
  option httplog
  option dontlognull
  timeout connect 5s
  timeout client 50s
  timeout server 50s

frontend http_front
  bind *:{{ haproxy_frontend_port }}
  default_backend backend_servers

backend backend_servers
  balance roundrobin
{% for host in groups['web'] %}
  server {{ host }} {{ hostvars[host]['ansible_host'] }}:{{ docker_backend_port }} check
{% endfor %}

listen stats
  bind *:{{ haproxy_stats_port }}
  stats enable
  stats uri /stats
  stats refresh 5s
 
